<style>
    /* Votre CSS professionnel est conservé à 100% */
    .groups-layout {
        display: grid;
        grid-template-columns: 300px 1fr;
        height: calc(100vh - 150px);
        /* ... Le reste de votre CSS ... */
    }
</style>

<div class="groups-layout">
    <div class="groups-list-panel">
        <div class="groups-header">
            <h3>Vos Groupes</h3>
            <button class="create-group-btn" id="createGroupBtn">Créer +</button>
        </div>
        <div id="groupsContainer"></div>
    </div>
    <div class="group-details-panel" id="groupDetailsPanel" style="display: none;">
        </div>
</div>

<script type="module">
    // --- NOUVELLE STRUCTURE : Import direct de la connexion ---
    import { supabaseClient } from '../supabaseClient.js';

    // Le script récupère lui-même l'utilisateur actuel
    const { data: { user } } = await supabaseClient.auth.getUser();
    const currentUser = user;

    if (!currentUser) {
        document.querySelector('.groups-layout').innerHTML = '<h2>Vous devez être connecté pour voir les groupes.</h2>';
        throw new Error("Utilisateur non connecté");
    }

    // Le reste de votre script, qui était déjà parfaitement fonctionnel, est conservé
    const createGroupBtn = document.getElementById('createGroupBtn');
    const groupsContainer = document.getElementById('groupsContainer');
    // ... (déclaration de tous vos autres éléments DOM)
    
    let allUsers = [];
    let currentGroups = [];
    let selectedGroupId = null;
    
    const renderGroups = () => { /* ... votre fonction renderGroups ... */ };
    
    const loadGroupDetails = async (groupId, groupName) => {
        // ... (votre fonction loadGroupDetails est ici)
    };

    const fetchGroups = async () => {
        // ... (votre fonction fetchGroups est ici)
    };

    // --- Event Listeners ---
    createGroupBtn.addEventListener('click', async () => { /* ... votre logique de création ... */ });
    groupsContainer.addEventListener('click', (e) => { /* ... votre logique de sélection ... */ });
    addMemberForm.addEventListener('submit', async (e) => { /* ... votre logique d'ajout de membre ... */ });

    // --- Initialisation ---
    const { data: users } = await supabaseClient.from('profiles').select('*');
    if (users) { allUsers = users; }

    await fetchGroups();

</script>
