<style>
    /* Votre CSS professionnel et complet est conservé */
    /* ... */
</style>

<div class="home-container" id="posts-feed">
    <div class="loading-message">
        <div class="loading-spinner"></div>
        Chargement des publications...
    </div>
</div>

<script type="module">
    // --- NOUVELLE STRUCTURE : Import direct de la connexion ---
    import { supabaseClient } from '../supabaseClient.js';

    const postsFeed = document.getElementById('posts-feed');
    if (!postsFeed) return;

    // Récupération de l'utilisateur actuel
    const { data: { user } } = await supabaseClient.auth.getUser();
    const currentUser = user;
    let currentUserProfile = null;
    
    // Le reste de votre script est quasi-identique car il était déjà très bien écrit
    let currentPage = 0;
    const postsPerPage = 10;
    let isLoading = false;
    let hasMorePosts = true;
    let allPosts = [];

    if (currentUser) {
        try {
            const { data } = await supabaseClient
                .from('profiles')
                .select('role')
                .eq('id', currentUser.id)
                .single();
            currentUserProfile = data;
        } catch (error) {
            console.warn('Impossible de récupérer le profil utilisateur:', error);
        }
    }

    // ... (La suite de votre code : formatDate, fetchPosts, renderPosts, etc. reste ici)
    // ... elle utilisera maintenant la variable "supabaseClient" importée directement.
    
    // Juste une petite correction : on passe supabaseClient et currentUser aux fonctions
    // pour être sûr qu'elles les utilisent bien.
    
    const fetchPosts = async (page = 0, append = false) => {
        // ... (votre logique fetchPosts est ici)
    };
    
    // etc.
</script>
